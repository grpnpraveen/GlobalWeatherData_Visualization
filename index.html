<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src = "https://cdn.jsdelivr.net/npm/d3@7"></script>
    <title>Document</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <nav class="nav-max">
        <header>
          <img src="./icon.jpg" style="width: 50px;border-radius: 8px;" alt="">
          <h1>Buzz Songs</h1><span>2023</span>
        </header>
        <button id="toggle-nav-btn" class="circle"></button>
        <br>
        <hr>
        <ul class="menu">
          <li>
            <a class="nav-link" href="#">
                <img src="./cat.png" style="width: 45px;border-radius: 8px;" alt="">
                <span>
                    Categorical 
                </span>
            </a>
            <div id="categorical" style="border-radius:8px;margin-top:5px;;margin-left: 60px;padding-left:30px;height: 25px;background:#7da6ff;">Fun</div>
          </li>
          <li>
            <a class="nav-link" href="#">
                <img src="./hist.png" style="width: 45px;border-radius: 8px;" alt="">
              <span>Numerical</span>
            </a>  
            <div id="categorical" style="border-radius:8px;margin-top:5px;;margin-left: 60px;padding-left:30px;height: 25px;background:#36393f;">Fun</div>
          </li>
          <li>
            <li>
                <a class="nav-link" href="#">
                    <img src="./direc.png" style="width: 45px;border-radius: 8px;" alt="">
                  <span>Direction</span>
                  <div class="check-box">
                    <input type="checkbox" checked>
                </div>
                </a>  
               
            </li>
        </ul>
      </nav>



    <!-- Data visualization -->
    <div class="main" style="margin-left: 180px;padding-top:30px;padding-left:200px;">

      <div id="visualization"></div>

    </div>


</body>
<script>
const navBar = document.querySelector("nav")
const toggleNavBtn = document.querySelector("#toggle-nav-btn")

toggleNavBtn.addEventListener("click", (event) => {
  toggleNav()
})

function toggleNav() {
  if (navBar.classList.contains("nav-min")){
    openNav()
  } else {
    closeNav()
  }
}

function openNav() {
  navBar.classList.remove("nav-min") 
  navBar.classList.add("nav-max") 
}

function closeNav() {
  navBar.classList.remove("nav-max") 
  navBar.classList.add("nav-min")
}


// Medias
const phone = window.matchMedia("(width <= 480px)")
function media(e) {
  if (e.matches) {
    closeNav()
  } else {
    openNav()
  }
}
phone.addListener(media)


// DATA Visualization
var data;
var graph_heigth=100;
// Load the CSV file  
d3.csv("data.csv").then(function(csvData) {
    // Save the data globally
    data = csvData;
    //Create initial visualization upon page load

    //createVisualization("country");
    //createVisualization("condition_text");
    //createVisualization("wind_direction");
    createVisualization("moon_phase");
}).catch(function(error) {
    // Handle any errors that occur during loading
    console.error("Error loading the CSV file:", error);
});

var data_info = {
  "country": {"type": "categorical", "heading":"Country","x_title":"Countries","y_title":"Frequency"},
  "condition_text": {"type": "categorical", "heading":"Weather Condition","x_title":"Condition","y_title":"Frequency"},
  "wind_direction": {"type": "categorical", "heading":"Wind direction","x_title":"Directions","y_title":"Frequency"},
  "moon_phase": {"type": "categorical", "heading":"Moon phases","x_title":"Phase","y_title":"Frequency"},

  "in_spotify_playlists": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "streams": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "in_apple_playlists": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "in_deezer_playlists": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "bpm": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "danceability_%": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "valence_%": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "energy_%": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "acousticness_%": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "instrumentalness_%": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "liveness_%": {"type": "numerical", "heading":"","x_title":"","y_title":""},
  "speechiness_%": {"type": "numerical", "heading":"","x_title":"","y_title":""}
};


var get_unique = (data,attribute) => {
  let unique_values = [
      ...new Set(data.map((element) => element[attribute])),
  ];
  return unique_values;
};

function get_graph_data(attribute)
{
  if(attribute=="country" || attribute=="condition_text" || attribute=="wind_direction" ||  attribute=="moon_phase")
  {
    var graph_data =[];
    var unique_countries = get_unique(data,attribute);

    console.log(unique_countries);
    for (let i = 0; i < unique_countries.length; i++) {
      var temp ={};
      temp[unique_countries[i]]=0;

      for (let j = 0; j < data.length; j++) {
        if( data[j][attribute]==unique_countries[i])
        {
          temp[unique_countries[i]]=temp[unique_countries[i]]+1;
        }
      }
      graph_data.push({"x_values":unique_countries[i],"y_values":temp[unique_countries[i]]});
    }
    return graph_data;
  }
}

// Function to create visualization based on user's selection
function createVisualization(selectedAttribute) {
    //var selectedDataType ="categorical";
    //var selectedAttribute = "Key";
    console.log(data_info[selectedAttribute]["type"])
    var selectedDataType = data_info[selectedAttribute]["type"];
    var selectedAttribute = selectedAttribute; 

    if (selectedDataType === "numerical") {
        createHistogram(selectedAttribute);
    }else if (selectedDataType === "categorical") {
        createBarGraph(selectedAttribute);
    }
}
</script>
<script src = "bargraph.js"></script>
<script src = "histogram.js"></script>
</html>